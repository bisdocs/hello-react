"use strict";(self.webpackChunklearnreact=self.webpackChunklearnreact||[]).push([[897],{5292:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>a});var t=r(4848),o=r(8453);const s={sidebar_position:4},i="Use Effect Hook",c={id:"react-hooks/use-effect",title:"Use Effect Hook",description:"useEffect is a React Hook that lets you synchronize a component with an external system.",source:"@site/docs/react-hooks/use-effect.md",sourceDirName:"react-hooks",slug:"/react-hooks/use-effect",permalink:"/hello-react/react-hooks/use-effect",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Use Context Hook",permalink:"/hello-react/react-hooks/use-context"},next:{title:"Use Ref Hook",permalink:"/hello-react/react-hooks/use-ref"}},l={},a=[{value:"Parameters",id:"parameters",level:2},{value:"Key Points",id:"key-points",level:2},{value:"Interaction &amp; Effects",id:"interaction--effects",level:2},{value:"Connecting to an external system",id:"connecting-to-an-external-system",level:2},{value:"Effect as custom hook",id:"effect-as-custom-hook",level:2},{value:"Controlling non-React widget",id:"controlling-non-react-widget",level:2},{value:"Fetching Data",id:"fetching-data",level:2},{value:"Reactive dependency",id:"reactive-dependency",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"use-effect-hook",children:"Use Effect Hook"}),"\n",(0,t.jsx)(n.p,{children:"useEffect is a React Hook that lets you synchronize a component with an external system."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Some components need to be synchronized with external systems"}),"\n",(0,t.jsx)(n.li,{children:"E.g Fetching data from a server, sending analytics log when a component appears on the screen."}),"\n",(0,t.jsx)(n.li,{children:"Effects let us run some code after rendering so that we can synchronize our component with some system outside of React."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function Component(props) {\r\n  useEffect(() => {\r\n\r\n    // Setup function\r\n    // This is where we need to place the logic for component's effects\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      // This function is called when the component is unmounted or before\r\n      // executing the setup function again. It's used to clean up any\r\n      // resources or effects set up by the component.\r\n    };\r\n\r\n  }, [/* Dependencies */]);\r\n\r\n  // Return JSX representing the component\r\n  return <div>Hello, World!</div>;\r\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"parameters",children:"Parameters"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Setup Function"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When component is added to the DOM then the setup function will run"}),"\n",(0,t.jsx)(n.li,{children:"When the state variables in the dependency arrays change, react will re render the component"}),"\n",(0,t.jsx)(n.li,{children:"React will first run the cleanup function (if provided) with old value"}),"\n",(0,t.jsx)(n.li,{children:"And then run the setup function with new value"}),"\n",(0,t.jsx)(n.li,{children:"After the component is removed from the DOM, it will run the cleanup function."}),"\n",(0,t.jsx)(n.li,{children:"Please note in the dependency array if we provide regular variables then it won't run useEffect hook if the variable value changes. We need to have state variables in the dependency array."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Dependencies"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The dependency array can include props, state, variable, functions declared directly in the function (reactive values)"}),"\n",(0,t.jsxs)(n.li,{children:["The dependencies should have a constant list of elements like ",(0,t.jsx)(n.code,{children:"[dep1, dep2]"})," etc"]}),"\n",(0,t.jsxs)(n.li,{children:["React will compare each dependency with its previous value using the ",(0,t.jsx)(n.code,{children:"Object.is"})," comparison."]}),"\n",(0,t.jsx)(n.li,{children:"So having a function in the dependency array won't be a good idea"}),"\n",(0,t.jsx)(n.li,{children:"If we are using any value inside the setup function then that should be in the dependency array"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Lets see what really happens during the exection"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Blank dependecy"})}),"\n",(0,t.jsx)(n.p,{children:"When the dependency array is blank the useEffect() will be called only once"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"It will execute when the component first renders"}),"\n",(0,t.jsx)(n.li,{children:"The subsequent re-renders it will not execute the useEffect"}),"\n",(0,t.jsxs)(n.li,{children:["Here ",(0,t.jsx)(n.code,{children:"use effect called for.."})," will log only once"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'function EffectDemo() {\r\n  const [counter, setCounter] = useState(0);\r\n\r\n  console.log("Component Loaded");\r\n\r\n  useEffect(() => {\r\n    console.log("use effect called for.." +counter);\r\n\r\n    return () => {\r\n      console.log("clean up is called.." +counter);\r\n    };\r\n  }, []);\r\n\r\n  return <>\r\n     <h1>Hello</h1>\r\n     <button onClick={()=>setCounter(counter+1)}>Click</button>\r\n  </>\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Dependency Array"})}),"\n",(0,t.jsx)(n.p,{children:"With dependency array the execution flow will be like below"}),"\n",(0,t.jsx)(n.p,{children:"First render"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Component Will load"}),"\n",(0,t.jsx)(n.li,{children:"useEffect will be called once for 0"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Re renders"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Then click on the button to increase the counter & trigger re render"}),"\n",(0,t.jsx)(n.li,{children:"Component will load"}),"\n",(0,t.jsx)(n.li,{children:"Cleanup function will be called for the previous value (i.e 0)"}),"\n",(0,t.jsx)(n.li,{children:"useEffect setup function will be called for the current value (i.e 1)"}),"\n",(0,t.jsx)(n.li,{children:"And this sequence continues"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Component is removed"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The cleanup function will be called once"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { useEffect, useState } from "react";\r\n\r\nfunction EffectDemo() {\r\n  const [counter, setCounter] = useState(0);\r\n\r\n  console.log("Component Loaded");\r\n\r\n  useEffect(() => {\r\n    console.log("use effect called for.." +counter);\r\n\r\n    return () => {\r\n      console.log("clean up is called.." +counter);\r\n    };\r\n  }, [counter]);\r\n\r\n  return <>\r\n     <h1>Hello</h1>\r\n     <button onClick={()=>setCounter(counter+1)}>Click</button>\r\n  </>\r\n}\r\n\r\nexport default EffectDemo;\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"No dependencies"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"dependencies is optional, we can remove it alltogether"}),"\n",(0,t.jsx)(n.li,{children:"If we remove this argument, the Effect will re-run after every re-render of the component."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'  useEffect(() => {\r\n    console.log("use effect called for.." +counter);\r\n\r\n    return () => {\r\n      console.log("clean up is called.." +counter);\r\n    };\r\n  });\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Primitive Variable as Dependency"})}),"\n",(0,t.jsx)(n.p,{children:"Lets say we have a primitive variable like string, so will useEffect run if this value changes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Changing the value of ",(0,t.jsx)(n.code,{children:"greet"})," within ",(0,t.jsx)(n.code,{children:"handleClick"})," doesn't cause a re-render of the component"]}),"\n",(0,t.jsx)(n.li,{children:"Because React doesn't track changes to local variables directly."}),"\n",(0,t.jsxs)(n.li,{children:["The useEffect hook is set up with a dependency array ",(0,t.jsx)(n.code,{children:"[greet]"})]}),"\n",(0,t.jsxs)(n.li,{children:["Means it will execute its function whenever ",(0,t.jsx)(n.code,{children:"greet"})," changes between renders."]}),"\n",(0,t.jsx)(n.li,{children:"However, since greet doesn't cause a re-render directly (as it's not a state variable or a prop)"}),"\n",(0,t.jsxs)(n.li,{children:["This effect will not be triggered when ",(0,t.jsx)(n.code,{children:"greet"})," changes in ",(0,t.jsx)(n.code,{children:"handleClick"})]}),"\n",(0,t.jsx)(n.li,{children:"We will have to make greet as state variable if we want to run effect when it changes."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'function Demo() {\r\n  let greet = "Hello";\r\n\r\n  const handleClick = () => {\r\n    greet = "hi";\r\n    console.log(greet);\r\n  };\r\n\r\n  useEffect(() => {\r\n    console.log(greet);\r\n  }, [greet]);\r\n  return (\r\n    <div>\r\n      <button onClick={handleClick}>Click</button>\r\n    </div>\r\n  );\r\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"key-points",children:"Key Points"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["useEffect is a function and it returns ",(0,t.jsx)(n.code,{children:"undefined"})]}),"\n",(0,t.jsx)(n.li,{children:"It's a hook, so declare at the top level and this can't be used in loops/if-else etc."}),"\n",(0,t.jsx)(n.li,{children:"If we are not trying to synchronize with external system then probably we don't need an effect"}),"\n",(0,t.jsx)(n.li,{children:"In strict mode react will run the useEffect twice - first setup+cleanup function to check if the cleanup function undoes/stops whatever the setup function is doing. It happens only in dev environment."}),"\n",(0,t.jsx)(n.li,{children:"If the dependencies are objects/functions defined in the component, it will cause useEffect to run more often than needed. So remove the unnecessary functions & objects from dependencies."}),"\n",(0,t.jsx)(n.li,{children:"React prioritizes the effects caused by user interactions (e.g click) otherwise it will paint the updated screen first and then run the effect."}),"\n",(0,t.jsxs)(n.li,{children:["If the effect is doing something on the UI(e.g positioning a tooltip) and the delay is visible(flickers) then make use of ",(0,t.jsx)(n.code,{children:"useLayoutEffect"})," instead of useEffect"]}),"\n",(0,t.jsx)(n.li,{children:"Effects only run on the client. They don\u2019t run during server rendering."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"interaction--effects",children:"Interaction & Effects"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Interaction-Based Effects"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When an effect is triggered by user interactions, like a button click (onClick), React typically prioritizes executing the effect immediately after the interaction event handler finishes."}),"\n",(0,t.jsx)(n.li,{children:"React may run your Effect before the browser paints the updated screen. This ensures that the result of the Effect can be observed by the event system."}),"\n",(0,t.jsx)(n.li,{children:"In other words it ensures that any side effects triggered by user actions (like updating state, fetching data, or navigating) happen promptly in response to user input."}),"\n",(0,t.jsx)(n.li,{children:"Usually, this works as expected. However, if you must defer the work until after paint, such as an alert(), you can use setTimeout."}),"\n",(0,t.jsx)(n.li,{children:"Even if the Effect was caused by an interaction (like a click), React may allow the browser to repaint the screen before processing the state updates inside your Effect."}),"\n",(0,t.jsx)(n.li,{children:"However, if you must block the browser from repainting the screen, you need to replace useEffect with useLayoutEffect."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Non-Interaction-Based Effects"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"In contrast, if an effect is not directly tied to a user interaction event (such as a timer, data fetching on component mount, or state change)"}),"\n",(0,t.jsx)(n.li,{children:"React tends to delay running these effects until after the browser has finished painting the updated screen."}),"\n",(0,t.jsx)(n.li,{children:"This delay allows React to optimize rendering performance by batching updates and avoiding unnecessary re-renders caused by effects that don't affect the current visible UI immediately."}),"\n",(0,t.jsx)(n.li,{children:"For effects not triggered by user interactions, React will typically wait until after it has finished updating the DOM with the latest changes before running the effect."}),"\n",(0,t.jsx)(n.li,{children:"This approach ensures that the user sees the most up-to-date UI without interruptions caused by ongoing background tasks or updates."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"connecting-to-an-external-system",children:"Connecting to an external system"}),"\n",(0,t.jsx)(n.p,{children:"Some components need to be connected to external systems (such as different network, browser API, third party library) while they are displayed on the page. The systems are not controlled by react so called as external systems."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Chat Room Example"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["When the ",(0,t.jsx)(n.code,{children:"ChatRoom"})," component gets added to the page, it will connect to the chat room with the initial ",(0,t.jsx)(n.code,{children:"serverUrl"})," and ",(0,t.jsx)(n.code,{children:"roomId"})]}),"\n",(0,t.jsxs)(n.li,{children:["If the user picks a different chat room (in a dropdown) then the ",(0,t.jsx)(n.code,{children:"serverUrl"})," or ",(0,t.jsx)(n.code,{children:"roomId"})," will change and trigger a re render of the component."]}),"\n",(0,t.jsx)(n.li,{children:"The changes in the effect dependency will rerun the effect. First it will disconnect from the previous room, and then connect to the next one."}),"\n",(0,t.jsx)(n.li,{children:"When the ChatRoom component is removed from the page, the Effect will disconnect one last time."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import { useEffect } from 'react';\r\nimport { createConnection } from './chat.js';\r\n\r\nfunction ChatRoom({ roomId }) {\r\n  const [serverUrl, setServerUrl] = useState('https://localhost:1234');\r\n\r\n  useEffect(() => {\r\n  \tconst connection = createConnection(serverUrl, roomId);\r\n    connection.connect();\r\n  \treturn () => {\r\n      connection.disconnect();\r\n  \t};\r\n  }, [serverUrl, roomId]);\r\n  // ...\r\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["It has two parameters","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Setup"})," function (that connects to a system), also the ",(0,t.jsx)(n.code,{children:"cleanup"})," function that disconnects from the system"]}),"\n",(0,t.jsxs)(n.li,{children:["List of ",(0,t.jsx)(n.code,{children:"dependencies"})," (every value from component that's used inside the effect function)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["The execution flow","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"React calls the setup function when the component is added to the page(mounts)"}),"\n",(0,t.jsxs)(n.li,{children:["After every re render of the component when the dependencies change","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"First the cleanup code runs with old props and state"}),"\n",(0,t.jsx)(n.li,{children:"Then the setup function runs with new props and state"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"The cleanup code runs one final time when the component is removed from the page."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Points"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Effect helps us to keep the component synchronized with external system."}),"\n",(0,t.jsx)(n.li,{children:"The external system means these are not controlled by react"}),"\n",(0,t.jsxs)(n.li,{children:["A timer managed with ",(0,t.jsx)(n.code,{children:"setInterval()"})," and ",(0,t.jsx)(n.code,{children:"clearInterval()"})]}),"\n",(0,t.jsxs)(n.li,{children:["An event subscription using ",(0,t.jsx)(n.code,{children:"window.addEventListener()"})," and ",(0,t.jsx)(n.code,{children:"window.removeEventListener()"})]}),"\n",(0,t.jsxs)(n.li,{children:["A third-party animation library with an API like ",(0,t.jsx)(n.code,{children:"animation.start()"})," and ",(0,t.jsx)(n.code,{children:"animation.reset()."})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"The Chat App"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import React, { useState } from "react";\r\nimport ChatRoom from "./ChatRoom";\r\n\r\nfunction ChatApp() {\r\n  const [roomId, setRoomId] = useState("general");\r\n  const [show, setShow] = useState(false);\r\n\r\n  return (\r\n    <div>\r\n      <label>\r\n        Choose the chat room:{" "}\r\n        <select value={roomId} onChange={(e) => setRoomId(e.target.value)}>\r\n          <option value="general">general</option>\r\n          <option value="travel">travel</option>\r\n          <option value="music">music</option>\r\n        </select>\r\n      </label>\r\n\r\n      <button onClick={() => setShow(!show)}>\r\n        {show ? "Close chat" : "Open chat"}\r\n      </button>\r\n      {show && <hr />}\r\n      {show && <ChatRoom roomId={roomId} />}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ChatApp;\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import React, { useState } from "react";\r\nimport { useEffect } from "react";\r\nimport { createConnection } from "./chat";\r\n\r\nfunction ChatRoom({ roomId }) {\r\n  const [serverUrl, setServerUrl] = useState("https://localhost:1234");\r\n\r\n  useEffect(() => {\r\n    const connection = createConnection(serverUrl, roomId);\r\n    connection.connect();\r\n\r\n    return () => {\r\n      connection.disconnect();\r\n    };\r\n  }, [roomId, serverUrl]);\r\n\r\n  return (\r\n    <div>\r\n      <label htmlFor="">Server URL</label>\r\n      <input\r\n        type="text"\r\n        value={serverUrl}\r\n        onChange={(e) => setServerUrl(e.target.value)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default ChatRoom;\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"export function createConnection(serverUrl, roomId) {\r\n  return {\r\n    connect() {\r\n      console.log(\r\n        '\u2705 Connecting to \"' + roomId + '\" room at ' + serverUrl + \"...\"\r\n      );\r\n    },\r\n    disconnect() {\r\n      console.log('\u274c Disconnected from \"' + roomId + '\" room at ' + serverUrl);\r\n    },\r\n  };\r\n}\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Window Listener"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import React, { useState } from "react";\r\nimport { useWindowListener } from "./useWindowListener";\r\n\r\nfunction WindowApp() {\r\n  const [position, setPosition] = useState({ x: 0, y: 0 });\r\n\r\n  useWindowListener("pointermove", (e) => {\r\n    setPosition({ x: e.clientX, y: e.clientY });\r\n  });\r\n  return (\r\n    <div\r\n      style={{\r\n        position: "absolute",\r\n        backgroundColor: "pink",\r\n        borderRadius: "50%",\r\n        opacity: 0.6,\r\n        transform: `translate(${position.x}px, ${position.y}px)`,\r\n        pointerEvents: "none",\r\n        left: -20,\r\n        top: -20,\r\n        width: 40,\r\n        height: 40,\r\n      }}\r\n    />\r\n  );\r\n}\r\n\r\nexport default WindowApp;\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { useEffect } from "react";\r\n\r\nexport function useWindowListener(eventType, listener) {\r\n  useEffect(() => {\r\n    window.addEventListener(eventType, listener);\r\n    return () => {\r\n      window.removeEventListener(eventType, listener);\r\n    };\r\n  }, [eventType, listener]);\r\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Trigerring Animation"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Here the external system is animation library ",(0,t.jsx)(n.code,{children:"animation.js"})]}),"\n",(0,t.jsx)(n.li,{children:"Refresh the page to see the animation loads"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"export class FadeInAnimation {\r\n  constructor(node) {\r\n    this.node = node;\r\n  }\r\n  start(duration) {\r\n    this.duration = duration;\r\n    if (this.duration === 0) {\r\n      // Jump to end immediately\r\n      this.onProgress(1);\r\n    } else {\r\n      this.onProgress(0);\r\n      // Start animating\r\n      this.startTime = performance.now();\r\n      this.frameId = requestAnimationFrame(() => this.onFrame());\r\n    }\r\n  }\r\n  onFrame() {\r\n    const timePassed = performance.now() - this.startTime;\r\n    const progress = Math.min(timePassed / this.duration, 1);\r\n    this.onProgress(progress);\r\n    if (progress < 1) {\r\n      // We still have more frames to paint\r\n      this.frameId = requestAnimationFrame(() => this.onFrame());\r\n    }\r\n  }\r\n  onProgress(progress) {\r\n    this.node.style.opacity = progress;\r\n  }\r\n  stop() {\r\n    cancelAnimationFrame(this.frameId);\r\n    this.startTime = null;\r\n    this.frameId = null;\r\n    this.duration = 0;\r\n  }\r\n}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import React, { useEffect, useRef } from "react";\r\nimport { FadeInAnimation } from "./Animation";\r\n\r\nfunction AniApp() {\r\n  const ref = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const animation = new FadeInAnimation(ref.current);\r\n    animation.start(3000);\r\n\r\n    return () => {\r\n      animation.stop();\r\n    };\r\n  }, []);\r\n  return (\r\n    <h1\r\n      ref={ref}\r\n      style={{\r\n        opacity: 0,\r\n        color: "white",\r\n        padding: 50,\r\n        textAlign: "center",\r\n        fontSize: 50,\r\n        backgroundImage:\r\n          "radial-gradient(circle, rgba(30, 30, 30, 1) 0%, rgba(255, 255, 255, 1) 100%)",\r\n      }}\r\n    >\r\n      Welcome\r\n    </h1>\r\n  );\r\n}\r\n\r\nexport default AniApp;\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Modal Dialog"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Here the external system is the browser DOM"}),"\n",(0,t.jsxs)(n.li,{children:["Uses effect to synchronize the ",(0,t.jsx)(n.code,{children:"isOpen"})," prop with ",(0,t.jsx)(n.code,{children:"showModal"})," & ",(0,t.jsx)(n.code,{children:"close"})]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import React, { useEffect, useRef } from "react";\r\nimport \'./ModalDialog.css\';\r\n\r\nfunction ModalDialog({ isOpen, children }) {\r\n  const ref = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (!isOpen) {\r\n      return;\r\n    }\r\n    const dialog = ref.current;\r\n    dialog.showModal();\r\n\r\n    return () => {\r\n      dialog.close();\r\n    };\r\n  }, [isOpen]);\r\n  return <dialog className="modal" ref={ref}>{children}</dialog>;\r\n}\r\n\r\nexport default ModalDialog;\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import React, { useState } from "react";\r\nimport ModalDialog from "./ModalDialog";\r\n\r\nfunction ModalApp() {\r\n  const [show, setShow] = useState(false);\r\n\r\n  return (\r\n    <>\r\n      <button onClick={() => setShow(true)}>Open Dialog</button>\r\n      <h1>Hello World</h1>\r\n      <ModalDialog isOpen={show}>\r\n        Hello There!\r\n        <br />\r\n        <button onClick={() => setShow(false)}>Close</button>\r\n      </ModalDialog>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ModalApp;\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Element Visibility"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Here the external system is browser DOM"}),"\n",(0,t.jsx)(n.li,{children:"When we scroll the page and the Box is fully in the view port, it changes the background color to black. If we scroll more and the box goes out of the view it changes to white."}),"\n",(0,t.jsxs)(n.li,{children:["Box component uses an effect to manage ",(0,t.jsx)(n.code,{children:"IntersectionObserver"})," the browser API notifies when the DOM element is visible in the view port."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { useRef, useEffect } from "react";\r\n\r\nexport default function Box() {\r\n  const ref = useRef(null);\r\n\r\n  useEffect(() => {\r\n    const div = ref.current;\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        const entry = entries[0];\r\n        if (entry.isIntersecting) {\r\n          document.body.style.backgroundColor = "black";\r\n          document.body.style.color = "white";\r\n        } else {\r\n          document.body.style.backgroundColor = "white";\r\n          document.body.style.color = "black";\r\n        }\r\n      },\r\n      {\r\n        threshold: 1.0,\r\n      }\r\n    );\r\n    observer.observe(div);\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      style={{\r\n        padding: 20,\r\n        border: "2px solid black",\r\n      }}\r\n    >\r\n      <h1>Next Article</h1>\r\n    </div>\r\n  );\r\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import React from "react";\r\nimport Box from "./Box";\r\n\r\nfunction VisibleApp() {\r\n  return (\r\n    <>\r\n      <LongSection />\r\n      <Box />\r\n      <LongSection />\r\n      <Box />\r\n      <LongSection />\r\n    </>\r\n  );\r\n}\r\n\r\nfunction LongSection() {\r\n  const text = `Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.`;\r\n\r\n  const items = [];\r\n  for (let i = 0; i < 50; i++) {\r\n    items.push(<li key={i}>{text}</li>);\r\n  }\r\n  return <ul>{items}</ul>;\r\n}\r\n\r\nexport default VisibleApp;\n'})}),"\n",(0,t.jsx)(n.h2,{id:"effect-as-custom-hook",children:"Effect as custom hook"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"When we write Effect more often then it's better to use as custom hook"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import { useEffect } from 'react';\r\nimport { createConnection } from './chat.js';\r\n\r\nexport function useChatRoom({ serverUrl, roomId }) {\r\n  useEffect(() => {\r\n    const connection = createConnection(serverUrl, roomId);\r\n    connection.connect();\r\n    return () => {\r\n      connection.disconnect();\r\n    };\r\n  }, [roomId, serverUrl]);\r\n}\r\n\r\n//in app.jsx call like this\r\n useChatRoom({\r\n    roomId: roomId,\r\n    serverUrl: serverUrl\r\n  });\n"})}),"\n",(0,t.jsx)(n.h2,{id:"controlling-non-react-widget",children:"Controlling non-React widget"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Sometimes we want to keep an external system synchronized to some prop in our component"}),"\n",(0,t.jsx)(n.li,{children:"For example, the zoom prop in our component can zoom in/out the actual map widget"}),"\n",(0,t.jsxs)(n.li,{children:["For below example install ",(0,t.jsx)(n.code,{children:"leaflet"}),", ",(0,t.jsx)(n.code,{children:"react-leaflet"})]}),"\n",(0,t.jsx)(n.li,{children:"Here cleanup function is not required, as the map widget works on a dom node. Once the component is removed from the DOM, the dom node will be removed also."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'//Map widget\r\nimport "leaflet/dist/leaflet.css";\r\nimport * as L from "leaflet";\r\n\r\nexport class MapWidget {\r\n  constructor(domNode) {\r\n    this.map = L.map(domNode, {\r\n      zoomControl: false,\r\n      doubleClickZoom: false,\r\n      boxZoom: false,\r\n      keyboard: false,\r\n      scrollWheelZoom: false,\r\n      zoomAnimation: false,\r\n      touchZoom: false,\r\n      zoomSnap: 0.1,\r\n    });\r\n    L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {\r\n      maxZoom: 19,\r\n      attribution: "\xa9 OpenStreetMap",\r\n    }).addTo(this.map);\r\n    this.map.setView([0, 0], 0);\r\n  }\r\n  setZoom(level) {\r\n    this.map.setZoom(level);\r\n  }\r\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"//Map component\r\nimport React, { useEffect, useRef } from 'react';\r\nimport { MapWidget } from './map-widget';\r\n\r\nfunction MapComponent({ zoomLevel }) {\r\n  const containerRef = useRef(null);\r\n  const mapRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (mapRef.current === null) {\r\n      mapRef.current = new MapWidget(containerRef.current);\r\n    }\r\n\r\n    const map = mapRef.current;\r\n    map.setZoom(zoomLevel);\r\n  }, [zoomLevel]);\r\n\r\n  return (\r\n    <div\r\n      style={{ width: 600, height: 600 }}\r\n      ref={containerRef}\r\n    />\r\n  );\r\n}\r\n\r\nexport default MapComponent;\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"import React, { useState } from 'react'\r\nimport MapComponent from './MapComponent';\r\n\r\nfunction MapApp() {\r\n    const [zoomLevel, setZoomLevel] = useState(0);\r\n    return (\r\n      <>\r\n        Zoom level: {zoomLevel}x\r\n        <button onClick={() => setZoomLevel(zoomLevel + 1)}>+</button>\r\n        <button onClick={() => setZoomLevel(zoomLevel - 1)}>-</button>\r\n        <hr />\r\n        <MapComponent zoomLevel={zoomLevel} />\r\n      </>\r\n    );\r\n}\r\n\r\nexport default MapApp\n"})}),"\n",(0,t.jsx)(n.h2,{id:"fetching-data",children:"Fetching Data"}),"\n",(0,t.jsx)(n.p,{children:"We can use an effect to fetch data for the component"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If we are using any framework then fetching data using the framework mechanism is better than writing effect manually"}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"ignore"})," variable initialized to ",(0,t.jsx)(n.code,{children:"false"})," and set to ",(0,t.jsx)(n.code,{children:"true"})," during cleanup. This is to prevent the code from race conditions as network responses may arrive in a different order than we have sent."]}),"\n",(0,t.jsx)(n.li,{children:"Writing the data fetch in the effect makes it difficult for performance optimization. So better to make it as custom hook or use some other library"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import { useEffect, useState } from "react";\r\n\r\nfunction DataFetch() {\r\n  const [person, setPerson] = useState("john");\r\n  const [bio, setBio] = useState(null);\r\n\r\n  useEffect(() => {\r\n    let ignore = false;\r\n    setBio(null);\r\n\r\n    async function fetchBio() {\r\n      const response = await fetch(\r\n        `https://dummyjson.com/users/search?q=${person}`\r\n      );\r\n      const result = await response.json();\r\n      if (!ignore) {\r\n        setBio(result.users[0]);\r\n      }\r\n    }\r\n\r\n    fetchBio();\r\n\r\n    return () => {\r\n      ignore = true;\r\n    };\r\n  }, [person]);\r\n\r\n  return (\r\n    <div>\r\n      <button onClick={() => setPerson("Michael")}>Next User</button>\r\n      <pre>{JSON.stringify(bio, null, 2)}</pre>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default DataFetch;\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Cons of fetching data directly"})}),"\n",(0,t.jsx)(n.p,{children:"This is a very popular way of fetching data however has significant downsides"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Effects don't run on the server, so server rendered HTML will include loading state & no data.\r\nThe client computer need to download all JS & render the app only to discover it needs to load the data."}),"\n",(0,t.jsx)(n.li,{children:"We render the parent component, it fetches some data, renders the child components and they start fetching their data. It creates a network waterfall. If the network is not fast, it's significantly slower process compared to fetching all data in parallel."}),"\n",(0,t.jsx)(n.li,{children:"Fetching data directly means we are not caching the data, so if the component unmounts & mounts, data needs to be fetched again"}),"\n",(0,t.jsx)(n.li,{children:"Morden react frameworks (e.g NextJS) has built in data fetching mechanism, prefer to use the same."}),"\n",(0,t.jsx)(n.li,{children:"Otherwise consider using client side cache React Query, React Router etc. We can build our own solution too."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"reactive-dependency",children:"Reactive dependency"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["We shouldn't ",(0,t.jsx)(n.code,{children:"choose"})," the dependencies of the Effect."]}),"\n",(0,t.jsx)(n.li,{children:"Every reactive value used by the Effect's code must be declared as a dependency."}),"\n",(0,t.jsxs)(n.li,{children:["If either ",(0,t.jsx)(n.code,{children:"serverUrl"})," or ",(0,t.jsx)(n.code,{children:"roomId"})," change, the Effect will reconnect to the chat using the new values."]}),"\n",(0,t.jsx)(n.li,{children:"Reactive values include props and all variables and functions declared directly inside of your component."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function ChatRoom({ roomId }) { // This is a reactive value\r\n  const [serverUrl, setServerUrl] = useState('https://localhost:1234'); \r\n  // This is a reactive value too\r\n\r\n  useEffect(() => {\r\n    const connection = createConnection(serverUrl, roomId); \r\n    // This Effect reads these reactive values\r\n    connection.connect();\r\n    return () => connection.disconnect();\r\n  }, [serverUrl, roomId]); \r\n  // \u2705 So you must specify them as dependencies of your Effect\r\n  // ...\r\n}\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If we correctly setup the linter then it will flag errors if we remove the reactive dependency."}),"\n",(0,t.jsx)(n.li,{children:"If we want to remove from the dependency then we will have to prove to the linter that it's not reactive (won't change on re-renders)"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const serverUrl = 'https://localhost:1234'; // Not a reactive value anymore\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If we remove all the dependencies, an effect with empty dependencies doesn\u2019t re-run when any of the component's props or state change."}),"\n",(0,t.jsx)(n.li,{children:"Sometimes we might see comments that suppresses the linter, which is not a good practice"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"useEffect(() => {\r\n  // ...\r\n  // \ud83d\udd34 Avoid suppressing the linter like this:\r\n  // eslint-ignore-next-line react-hooks/exhaustive-deps\r\n}, []);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Having Dependency Array"})}),"\n",(0,t.jsx)(n.p,{children:"If we specify the dependencies, the Effect runs after the initial render and after re-renders with changed dependencies."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"//Dependency Array\r\nuseEffect(() => {\r\n  // ...\r\n}, [a, b]); // Runs again if a or b are different\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Empty Dependency"})}),"\n",(0,t.jsx)(n.p,{children:"If the Effect truly doesn\u2019t use any reactive values, it will only run after the initial render."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"//Empty dependency array\r\nuseEffect(() => {\r\n  // ...\r\n}, []); // Does not run again (except once in development)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"No Dependency"})}),"\n",(0,t.jsx)(n.p,{children:"If we pass no dependency array at all, the Effect runs after every single render (and re-render) of the component."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"useEffect(() => {\r\n  // ...\r\n}); // Always runs again\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Update State Based on previous state from Effect"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If we use ",(0,t.jsx)(n.code,{children:"setCounter(counter+1)"})," & use the ",(0,t.jsx)(n.code,{children:"counter"})," in the dependency array  then we might run into a problem"]}),"\n",(0,t.jsx)(n.li,{children:"When we specify the counter as dependency it resets the interval"}),"\n",(0,t.jsx)(n.li,{children:"The correct approach is to use the updater function and remove the counter dependency."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:'import React, { useEffect, useState } from "react";\r\n\r\nfunction CounterApp() {\r\n  const [counter, setCounter] = useState(0);\r\n\r\n  useEffect(() => {\r\n    const intervalId = setInterval(() => {\r\n      setCounter(prevCounter => prevCounter+1);\r\n    }, 1000);\r\n\r\n    return () => {\r\n      clearInterval(intervalId);\r\n    };\r\n  }, []);\r\n  return (\r\n    <div>\r\n      <h1> {counter}</h1>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CounterApp;\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Removing Object Dependency"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Don't specify the object as dependency"}),"\n",(0,t.jsx)(n.li,{children:"Every re-render the object is created from scratch and it will run the effect"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"const serverUrl = 'https://localhost:1234';\r\n\r\nfunction ChatRoom({ roomId }) {\r\n  const [message, setMessage] = useState('');\r\n\r\n  const options = { // \ud83d\udea9 This object is created from scratch on every re-render\r\n    serverUrl: serverUrl,\r\n    roomId: roomId\r\n  };\r\n\r\n  useEffect(() => {\r\n    const connection = createConnection(options); // It's used inside the Effect\r\n    connection.connect();\r\n    return () => connection.disconnect();\r\n  }, [options]); // \ud83d\udea9 As a result, these dependencies are always different on a re-render\r\n  // ...\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Instead create the object inside the useEffect"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"useEffect(() => {\r\n    const options = {\r\n      serverUrl: serverUrl,\r\n      roomId: roomId\r\n    };\r\n    const connection = createConnection(options);\r\n    connection.connect();\r\n    return () => connection.disconnect();\r\n  }, [roomId]);\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Removing unnecessary function dependencies"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Don't use functions as dependency as it might run too often"}),"\n",(0,t.jsxs)(n.li,{children:["Here the effect reconnects after every render because the ",(0,t.jsx)(n.code,{children:"createOptions"})," function is different for every render"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"function ChatRoom({ roomId }) {\r\n  const [message, setMessage] = useState('');\r\n\r\n  function createOptions() { // \ud83d\udea9 This function is created from scratch on every re-render\r\n    return {\r\n      serverUrl: serverUrl,\r\n      roomId: roomId\r\n    };\r\n  }\r\n\r\n  useEffect(() => {\r\n    const options = createOptions(); // It's used inside the Effect\r\n    const connection = createConnection(options);\r\n    connection.connect();\r\n    return () => connection.disconnect();\r\n  }, [createOptions]); // \ud83d\udea9 As a result, these dependencies are always different on a re-render\r\n  // ...\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Instead create the function inside useEffect"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-jsx",children:"  useEffect(() => {\r\n    function createOptions() {\r\n      return {\r\n        serverUrl: serverUrl,\r\n        roomId: roomId\r\n      };\r\n    }\r\n\r\n    const options = createOptions();\r\n    const connection = createConnection(options);\r\n    connection.connect();\r\n    return () => connection.disconnect();\r\n  }, [roomId]);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"useEffectEvent"}),"\n",(0,t.jsx)(n.li,{children:"Displaying different content on the server and the client"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://react.dev/learn/you-might-not-need-an-effect",children:"You might not need an effect"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://react.dev/reference/react/useEffect",children:"Official docs"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>c});var t=r(6540);const o={},s=t.createContext(o);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);